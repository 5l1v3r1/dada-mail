<!-- tmpl_if kcfinder_enabled --> 
	function openKCFinder(field_name, url, type, win) {
	    tinyMCE.activeEditor.windowManager.open({
	        file           : '<!-- tmpl_var file_manager_browse_url -->?opener=tinymce&type=' + type,
	        title          : 'KCFinder',
	        width          : 700,
	        height         : 500,
	        resizable      : "yes",
	        inline         : true,
	        close_previous : "no",
	        popup_css      : false
	    }, {
	        window : win,
	        input  : field_name
	    });
	    return false;
	}
<!-- /tmpl_if --> 

<!-- tmpl_if core5_filemanager --> 

	function openCore5_filemanager(field_name, url, type, win) { 
    
          // from http://andylangton.co.uk/blog/development/get-viewport-size-width-and-height-javascript
          var w = window,
          d = document,
          e = d.documentElement,
          g = d.getElementsByTagName('body')[0],
          x = w.innerWidth || e.clientWidth || g.clientWidth,
          y = w.innerHeight|| e.clientHeight|| g.clientHeight;

	    var cmsURL = '<!-- tmpl_var file_manager_browse_url -->?&field_name='+field_name+'&lang='+tinymce.settings.language;
    
	    if(type == 'image') {		    
	    	cmsURL = cmsURL + "&type=images";
	    }

	    tinyMCE.activeEditor.windowManager.open({
	        file : cmsURL,
	        title : 'Filemanager',
	        width : x * 0.8,
	        height : y * 0.8,
	        resizable : "yes",
	        close_previous : "no"
	    });   
	}
<!-- /tmpl_if --> 


tinymce.init({

<!-- tmpl_if kcfinder_enabled --> 
	file_browser_callback           : "openKCFinder",
<!-- /tmpl_if -->
<!-- tmpl_if core5_filemanager --> 
	file_browser_callback           : "openCore5_filemanager",
<!-- /tmpl_if -->


    selector: "textarea#html_message_body",

    plugins: [
        "advlist autolink lists link image charmap preview hr anchor ",
        "searchreplace wordcount visualblocks visualchars code fullscreen",
        "nonbreaking table contextmenu directionality",
        "emoticons paste textcolor"
    ],

    image_advtab: true,
    paste_data_images: true,
	
	
    toolbar1: "undo redo  | bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | styleselect | bullist numlist outdent indent | link image",
    toolbar2: "preview | forecolor backcolor emoticons code",
	
	
    document_base_url               : "<!-- tmpl_var support_files_dir_url -->/<!-- tmpl_var Support_Files_Dir_Name -->/"
	
 });